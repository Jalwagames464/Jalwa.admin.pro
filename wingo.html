<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wingo Pro Control - Admin</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #06091b; --card: #10142d; --gold: #ffd700; --green: #1DB954; --red: #ff4757; --violet: #9c27b0; --cyan: #00ffca; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; overflow-x: hidden; }
        
        .header { text-align: center; padding: 15px; background: var(--card); border-bottom: 2px solid var(--cyan); margin-bottom: 15px; border-radius: 0 0 20px 20px; }
        .timer-box { font-size: 30px; color: var(--gold); font-weight: bold; font-family: monospace; }

        /* COLOR CARDS */
        .color-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .color-card { padding: 20px 5px; border-radius: 12px; text-align: center; font-weight: bold; cursor: pointer; border: 2px solid transparent; transition: 0.2s; }
        .color-card:active { transform: scale(0.9); }
        .amt-tag { display: block; font-size: 16px; margin-top: 5px; color: white; background: rgba(0,0,0,0.3); border-radius: 5px; }

        /* NUMBER BALLS */
        .num-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 20px; }
        .num-ball { width: 100%; aspect-ratio: 1/1; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; font-weight: bold; position: relative; border: 2px solid #1f2855; }
        .num-ball:active { transform: scale(0.8); }
        .num-amt { font-size: 10px; color: #ffd700; position: absolute; bottom: 5px; }

        .bg-green { background: var(--green); }
        .bg-red { background: var(--red); }
        .bg-violet { background: var(--violet); }
        .bg-0 { background: linear-gradient(135deg, var(--red) 50%, var(--violet) 50%); }
        .bg-5 { background: linear-gradient(135deg, var(--green) 50%, var(--violet) 50%); }

        /* SELECTION HIGHLIGHT */
        .selected { border: 3px solid white !important; box-shadow: 0 0 15px white; }

        /* ANALYSIS PANEL */
        .calc-panel { background: var(--card); padding: 15px; border-radius: 15px; border: 1px solid #1f2855; }
        .calc-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #1f2855; }
        
        #toast { visibility: hidden; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: var(--cyan); color: #000; padding: 12px 30px; border-radius: 30px; font-weight: bold; z-index: 10000; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        #toast.show { visibility: visible; animation: slideDown 0.3s; }
        @keyframes slideDown { from { top: -50px; } to { top: 20px; } }
    </style>
</head>
<body>

<div id="toast">Result Set!</div>

<div class="header">
    <div class="timer-box" id="timer">00:00</div>
    <div id="pIdDisplay" style="font-size:12px; color:#7e87a8; margin-top:5px;">Period: ...</div>
</div>

<div style="padding: 10px; font-size: 12px; color: #7e87a8;">TAP TO FIX RESULT:</div>
<div class="color-row">
    <div id="btnGreen" class="color-card bg-green" onclick="setAdminResult('Green', this)">GREEN <span class="amt-tag" id="loadGreen">â‚¹0</span></div>
    <div id="btnViolet" class="color-card bg-violet" onclick="setAdminResult('Violet', this)">VIOLET <span class="amt-tag" id="loadViolet">â‚¹0</span></div>
    <div id="btnRed" class="color-card bg-red" onclick="setAdminResult('Red', this)">RED <span class="amt-tag" id="loadRed">â‚¹0</span></div>
</div>

<div class="num-grid">
    <div id="n0" class="num-ball bg-0" onclick="setAdminResult(0, this)">0 <span class="num-amt" id="l0">â‚¹0</span></div>
    <div id="n1" class="num-ball bg-green" onclick="setAdminResult(1, this)">1 <span class="num-amt" id="l1">â‚¹0</span></div>
    <div id="n2" class="num-ball bg-red" onclick="setAdminResult(2, this)">2 <span class="num-amt" id="l2">â‚¹0</span></div>
    <div id="n3" class="num-ball bg-green" onclick="setAdminResult(3, this)">3 <span class="num-amt" id="l3">â‚¹0</span></div>
    <div id="n4" class="num-ball bg-red" onclick="setAdminResult(4, this)">4 <span class="num-amt" id="l4">â‚¹0</span></div>
    <div id="n5" class="num-ball bg-5" onclick="setAdminResult(5, this)">5 <span class="num-amt" id="l5">â‚¹0</span></div>
    <div id="n6" class="num-ball bg-red" onclick="setAdminResult(6, this)">6 <span class="num-amt" id="l6">â‚¹0</span></div>
    <div id="n7" class="num-ball bg-green" onclick="setAdminResult(7, this)">7 <span class="num-amt" id="l7">â‚¹0</span></div>
    <div id="n8" class="num-ball bg-red" onclick="setAdminResult(8, this)">8 <span class="num-amt" id="l8">â‚¹0</span></div>
    <div id="n9" class="num-ball bg-green" onclick="setAdminResult(9, this)">9 <span class="num-amt" id="l9">â‚¹0</span></div>
</div>

<div class="calc-panel">
    <div style="color:var(--cyan); font-weight:bold; margin-bottom:10px;">LIVE BET ANALYSIS</div>
    <div class="calc-row"><span>Total Bets:</span><span id="totalColl" style="color:var(--gold)">â‚¹0</span></div>
    <div class="calc-row" id="advice" style="color:var(--cyan); justify-content:center; border:none; font-weight:bold;">WAITING FOR DATA...</div>
</div>

<script>
    // --- ðŸš¨ CRITICAL: DATABASE MATCHING ---
    const firebaseConfig = { databaseURL: "https://jalwav7-default-rtdb.firebaseio.com" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function setAdminResult(val, el) {
        // User game engine 'gameControl/nextResult' path par data bhej raha hai
        db.ref('gameControl/nextResult').set(val).then(() => {
            // UI Update
            document.querySelectorAll('.color-card, .num-ball').forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');
            
            // Toast Show
            const t = document.getElementById('toast');
            t.innerText = "COMMAND SENT: " + val;
            t.className = "show";
            setTimeout(() => t.className = "", 2000);
        });
    }

    function syncData(pId) {
        // Real-time bets fetch karna user side se
        db.ref('bets/' + pId).on('value', snap => {
            let loads = { Green:0, Violet:0, Red:0, 0:0, 1:0, 2:0, 3:0, 4:0, 5:0, 6:0, 7:0, 8:0, 9:0 };
            let total = 0;
            
            snap.forEach(child => {
                let b = child.val();
                if(loads.hasOwnProperty(b.sel)) {
                    loads[b.sel] += Number(b.amt);
                    total += Number(b.amt);
                }
            });

            // Update UI Amounts
            ['Green', 'Red', 'Violet'].forEach(c => document.getElementById('load' + c).innerText = 'â‚¹' + loads[c]);
            for(let i=0; i<=9; i++) document.getElementById('l' + i).innerText = 'â‚¹' + loads[i];
            
            document.getElementById('totalColl').innerText = 'â‚¹' + total;
            
            if(total > 0) {
                // Profit Advice
                let gCost = loads.Green * 2;
                let rCost = loads.Red * 2;
                let advice = gCost < rCost ? "ADVICE: WIN GREEN" : "ADVICE: WIN RED";
                document.getElementById('advice').innerText = advice;
            }
        });
    }

    // Timer Sync (Matches User side 30s)
    setInterval(() => {
        const now = new Date();
        const rem = 30 - (now.getSeconds() % 30);
        const pId = now.getFullYear().toString() + (now.getMonth()+1) + now.getDate() + Math.floor(((now.getHours()*3600)+(now.getMinutes()*60)+now.getSeconds())/30);
        
        document.getElementById('timer').innerText = "00:" + rem.toString().padStart(2, '0');
        document.getElementById('pIdDisplay').innerText = "Period: " + pId;

        // Auto clean selection after round ends
        if(rem === 29) {
            document.querySelectorAll('.color-card, .num-ball').forEach(b => b.classList.remove('selected'));
        }

        if (window.lastPid !== pId) {
            window.lastPid = pId;
            syncData(pId);
        }
    }, 1000);
</script>
</body>
</html>
